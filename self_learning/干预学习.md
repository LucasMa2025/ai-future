我来详细说明 NLGSM 治理系统如何干预自学习系统的学习过程。让我先查看现有的相关实现：


## NLGSM 治理系统干预自学习过程的完整机制

### 1. 干预流程架构图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        NLGSM 治理系统                                    │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                 │
│  │  状态机服务  │    │  审批服务   │    │  审计服务   │                 │
│  │(StateMachine)│    │ (Approval)  │    │  (Audit)    │                 │
│  └──────┬──────┘    └──────┬──────┘    └──────┬──────┘                 │
│         │                  │                  │                         │
│         ▼                  ▼                  ▼                         │
│  ┌─────────────────────────────────────────────────────┐               │
│  │            GovernanceInterface (治理接口)            │               │
│  │  - issue_intervention()    发起干预                  │               │
│  │  - review_checkpoint()     审查检查点                │               │
│  │  - receive_audit_feedback() 接收审计反馈             │               │
│  └──────────────────────────┬──────────────────────────┘               │
└─────────────────────────────┼───────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        自学习系统                                        │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                 │
│  │  Explorer   │    │ Knowledge   │    │ Checkpoint  │                 │
│  │ (LLM 探索)  │    │  Generator  │    │   Manager   │                 │
│  └──────┬──────┘    └──────┬──────┘    └──────┬──────┘                 │
│         │                  │                  │                         │
│         ▼                  ▼                  ▼                         │
│  ┌─────────────────────────────────────────────────────┐               │
│  │        NLLearningUnitBuilder (NL 增强构建器)          │               │
│  │  - 在 LearningScope 控制下学习                        │               │
│  │  - 自动创建 Checkpoint                               │               │
│  │  - 生成 Learning Unit                                │               │
│  └──────────────────────────┬──────────────────────────┘               │
│                             │                                           │
│                             ▼                                           │
│  ┌─────────────────────────────────────────────────────┐               │
│  │          NL Kernel (Nested Learning 内核)            │               │
│  │  - freeze()/unfreeze() 冻结/解冻                     │               │
│  │  - create_snapshot() 创建快照                        │               │
│  │  - rollback_to_state() 回滚状态                      │               │
│  └─────────────────────────────────────────────────────┘               │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2. 干预类型

| 干预类型 | 说明 | 优先级 |
|---------|------|-------|
| `PAUSE` | 暂停学习，冻结 NL 内核 | HIGH |
| `RESUME` | 恢复学习，解冻内核 | HIGH |
| `TERMINATE` | 终止学习，创建快照 | CRITICAL |
| `MODIFY_SCOPE` | 修改学习范围（层级、预算） | HIGH |
| `MODIFY_GOAL` | 修改学习目标 | HIGH |
| `ROLLBACK` | 回滚到指定检查点 | CRITICAL |
| `INJECT_CONSTRAINT` | 注入额外约束 | NORMAL |
| `REQUEST_CHECKPOINT` | 请求创建检查点 | NORMAL |

### 3. 检查点审查流程

```
自学习执行
    │
    ▼
达到阈值（知识数量/时间间隔）
    │
    ▼
自动创建 Checkpoint ─────────────────────▶ 通知治理系统
    │                                            │
    ▼                                            ▼
继续学习 ◀─────────────────────────────── 治理审查决策
    │                                     │
    │  ┌──────────────────────────────────┤
    │  │                                  │
    │  ▼                                  ▼
    │  continue: 继续              modify: 修改 Scope/Goal
    │                                     │
    │                                     ▼
    │                              应用修改后继续
    │
    │  ┌──────────────────────────────────┤
    │  │                                  │
    │  ▼                                  ▼
    │  pause: 暂停等待             terminate: 终止学习
    │     │                               │
    │     ▼                               ▼
    │  人工审查后恢复              创建快照，结束会话
```

### 4. Learning Unit 审计反馈

```python
# 审计反馈处理
governance.receive_audit_feedback(
    learning_unit_id="lu_001",
    decision=AuditStatus.APPROVED,    # 或 REJECTED, NEEDS_REVISION
    risk_level=RiskLevel.MEDIUM,      # 风险等级由审计系统定义
    comments="审计意见",
    
    # 如果拒绝
    rejection_reason="拒绝原因",
    
    # 如果需要重新学习
    relearn_guidance={
        "new_goal": "修改后的目标",
        "constraints": ["额外约束"],
        "max_level": "PARAMETER",
    },
)
```

### 5. 代码示例

```python
# 1. 创建治理接口
from self_learning import (
    GovernanceInterface, 
    InterventionType,
    InterventionPriority,
    KernelFactory,
    CheckpointManager,
)

kernel = KernelFactory.create_with_adapter("ollama", model="llama3.2")
checkpoint_manager = CheckpointManager()
governance = GovernanceInterface(kernel, checkpoint_manager)

# 2. 发起干预 - 暂停学习
governance.issue_intervention(
    intervention_type=InterventionType.PAUSE,
    reason="发现异常模式，需要人工审查",
    issued_by="monitoring_system",
    priority=InterventionPriority.HIGH,
)

# 3. 审查检查点 - 修改学习范围
from self_learning import LearningScope, NLLevel

new_scope = LearningScope(
    scope_id="restricted_scope",
    max_level=NLLevel.PARAMETER,  # 限制到最低层级
    allowed_levels=[NLLevel.PARAMETER],
)

governance.review_checkpoint(
    checkpoint_id="ckpt_xxx",
    decision="modify",
    modified_scope=new_scope,
    comments="风险过高，限制学习范围",
    reviewed_by="governance_admin",
)

# 4. 恢复学习
governance.issue_intervention(
    intervention_type=InterventionType.RESUME,
    reason="审查完成",
    issued_by="governance_admin",
)

# 5. 发现问题 - 回滚到检查点
governance.issue_intervention(
    intervention_type=InterventionType.ROLLBACK,
    reason="学习方向错误，需要回滚",
    issued_by="governance_admin",
    target_checkpoint_id="ckpt_earlier",
    priority=InterventionPriority.CRITICAL,
)

# 6. 终止学习
governance.issue_intervention(
    intervention_type=InterventionType.TERMINATE,
    reason="本次学习目标已达成",
    issued_by="governance_system",
)
```

### 6. 核心治理原则

1. **自学习系统无权定义风险等级** - 风险等级由审计系统根据 Scope 和内容确定
2. **自学习系统无权直接写入生产系统** - 必须通过审计和桥接流程
3. **所有学习必须在 Scope 控制下进行** - 治理系统提供 LearningScope
4. **治理系统可随时干预学习过程** - 通过 GovernanceInterface

演示代码
- `工程代码/AGI_Phase2/self_learning/governance_interface.py` - 治理接口实现
- `工程代码/AGI_Phase2/examples/governance_intervention_demo.py` - 演示示例